(function(t){function e(e){for(var o,s,c=e[0],r=e[1],l=e[2],d=0,f=[];d<c.length;d++)s=c[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&f.push(i[s][0]),i[s]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);u&&u(e);while(f.length)f.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],o=!0,c=1;c<n.length;c++){var r=n[c];0!==i[r]&&(o=!1)}o&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},i={app:0},a=[];function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var u=r;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1:function(t,e){},"21bb":function(t,e,n){"use strict";var o=n("d63f"),i=n.n(o);i.a},4931:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-content",{staticClass:"main-content"},[n("v-alert",{attrs:{type:"info",dismissible:""},model:{value:t.isShowInfo,callback:function(e){t.isShowInfo=e},expression:"isShowInfo"}},[t._v(" "+t._s(t.info)+" ")]),n("router-view")],1),n("v-navigation-drawer",{attrs:{"mini-variant":t.mini,fixed:"",permanent:"","expand-on-hover":""},on:{"update:miniVariant":function(e){t.mini=e},"update:mini-variant":function(e){t.mini=e}},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[n("v-list-item",[n("v-list-item-avatar",[n("v-avatar",{directives:[{name:"show",rawName:"v-show",value:t.mini,expression:"mini"}],attrs:{color:"indigo",size:"48"}},[n("span",{staticClass:"white--text headline"},[t._v(t._s(t.getMiniName))])]),n("v-avatar",{directives:[{name:"show",rawName:"v-show",value:!t.mini,expression:"!mini"}],attrs:{color:"indigo","min-width":150,tile:""}},[n("span",{staticClass:"white--text headline"},[t._v(t._s(t.getName))])])],1)],1),n("v-divider"),n("v-list",{attrs:{dense:""}},t._l(t.items,(function(e){return n("v-list-item",{key:e.title,attrs:{link:"",to:e.path}},[n("v-list-item-icon",[n("v-icon",[t._v(t._s(e.icon))])],1),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(e.title))])],1)],1)})),1)],1),n("v-dialog",{attrs:{"max-width":"400",persistent:""},model:{value:t.isShowModal,callback:function(e){t.isShowModal=e},expression:"isShowModal"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("設定暱稱")]),n("v-card-text",[n("v-form",{ref:"form",staticClass:"name-form",on:{submit:function(e){return e.preventDefault(),t.sendName(t.name)}},model:{value:t.nameValid,callback:function(e){t.nameValid=e},expression:"nameValid"}},[n("v-text-field",{ref:"nameInputRef",attrs:{counter:8,rules:t.nameRules,label:"輸入暱稱...",required:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),n("v-btn",{staticClass:"blue darken-2",attrs:{type:"submit",disabled:!t.nameValid,block:""}},[n("v-icon",[t._v("mdi-send")])],1)],1)],1)],1)],1),n("v-overlay",{attrs:{value:t.isShowOverlay}},[n("span",[t._v(" 與伺服器連線中 "),n("v-btn",{attrs:{loading:!0,icon:""}},[n("v-icon",[t._v("mdi-loading")])],1)],1)])],1)},a=[],s=(n("b0c0"),{name:"App",components:{},data:function(){return{name:"",info:"",isShowOverlay:!0,isShowInfo:!1,avatarWidth:200,isShowModal:!0,drawer:!0,items:[{title:"大廳",icon:"mdi-home",path:"/"},{title:"聊天",icon:"mdi-chat",path:"chat"}],mini:!0,nameValid:!1,nameRules:[function(t){return!!t||"不可為空"},function(t){return t&&t.length<=8||"不能超過8個字"}]}},computed:{getSocket:function(){return this.$store.getters["socket/getData"]},getName:function(){return this.$store.getters["socket/getName"]},getMiniName:function(){var t=this.$store.getters["socket/getName"];return t.substring(0,1)}},mounted:function(){var t=this,e=localStorage.getItem("name")||null;e&&(this.name=e,this.setName(e)),this.$nextTick((function(){setTimeout((function(){t.$refs.nameInputRef.focus()}),500)})),this.setSocketChecker((function(){t.isShowOverlay=!1,t.getSocket.on("connect",(function(){t.isShowOverlay=!1})),t.getSocket.on("pair",(function(e){t.setIsPaired(!0),t.setIsPairing(!1)})),t.getSocket.on("unpair",(function(e){t.getSocket.id!=e.socketId?(t.info="對方".concat(e.content),t.isShowInfo=!0):(t.info="".concat(e.content),t.isShowInfo=!0),t.setIsPaired(!1),t.setIsPairing(!1)})),t.getSocket.on("chat",(function(e){t.pushChats(e)})),t.getSocket.on("disconnect",(function(e){t.isShowOverlay=!0}))}))},beforeDestroy:function(){this.getSocket.removeAllListeners(),this.getSocket.disconnect()},methods:{setName:function(t){return!!(this.nameValid&&t&&t.length<=8)&&(localStorage.setItem("name",t),this.$store.commit("socket/setName",t),!0)},sendName:function(t){var e=this.setName(t);e&&(this.isShowModal=!1)},setIsPaired:function(t){this.$store.commit("socket/setIsPaired",t)},setIsPairing:function(t){this.$store.commit("socket/setIsPairing",t)},clearChats:function(){this.$store.commit("socket/setChats",[])},pushChats:function(t){this.$store.commit("socket/pushChats",t)},setSocketChecker:function(t){var e=this,n=5e3,o=setInterval((function(){try{e.getSocket&&(t(),clearInterval(o))}catch(n){clearInterval(o)}}),n)}}}),c=s,r=(n("5c0b"),n("2877")),l=n("6544"),u=n.n(l),d=n("0798"),f=n("7496"),m=n("8212"),h=n("8336"),v=n("b0af"),g=n("99d9"),b=n("a75b"),p=n("169a"),k=n("ce7e"),w=n("4bd4"),y=n("132d"),C=n("8860"),I=n("da13"),S=n("8270"),x=n("5d23"),V=n("34c3"),_=n("f774"),P=n("a797"),$=n("8654"),D=Object(r["a"])(c,i,a,!1,null,null,null),N=D.exports;u()(D,{VAlert:d["a"],VApp:f["a"],VAvatar:m["a"],VBtn:h["a"],VCard:v["a"],VCardText:g["a"],VCardTitle:g["b"],VContent:b["a"],VDialog:p["a"],VDivider:k["a"],VForm:w["a"],VIcon:y["a"],VList:C["a"],VListItem:I["a"],VListItemAvatar:S["a"],VListItemContent:x["a"],VListItemIcon:V["a"],VListItemTitle:x["b"],VNavigationDrawer:_["a"],VOverlay:P["a"],VTextField:$["a"]});var A=n("9483");Object(A["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});var M=n("8c4f"),T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{id:"container"}},[n("h1",[t._v("聊天大廳")]),n("blockquote",{staticClass:"blockquote"},[t._v(" 輸入限制: 最多100個字、五秒輸入一次 ")]),n("v-card",{staticClass:"chat-box"},t._l(t.getLobby,(function(e,o){return n("div",{key:o,staticClass:"d-flex"},[n("div",{staticClass:"mt-2 ml-2"},[n("v-avatar",{class:{indigo:t.getSocket.id==e.socketId,green:t.getSocket.id!=e.socketId},attrs:{size:32,width:140,tile:""}},[n("span",{staticClass:"white--text headline"},[t._v(" "+t._s(e.name)+" ")])]),n("span",[t._v(" "+t._s(e.content)+" ")])],1)])})),0),n("v-form",{ref:"lobbyForm",staticClass:"msg-form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.sendMsg(t.lobby)}},model:{value:t.lobbyValid,callback:function(e){t.lobbyValid=e},expression:"lobbyValid"}},[n("v-container",[n("v-row",[n("v-col",{attrs:{cols:"12",sm:"10",xs:"12"}},[n("v-text-field",{ref:"lobbyContentRef",attrs:{counter:100,rules:t.contentRules,label:"輸入訊息...",required:""},model:{value:t.lobby.content,callback:function(e){t.$set(t.lobby,"content",e)},expression:"lobby.content"}})],1),n("v-col",{attrs:{cols:"12",sm:"2",xs:"12"}},[n("v-btn",{staticClass:"yellow darken-2",attrs:{type:"submit",block:"",loading:t.isSendWait,disabled:t.isSendWait}},[n("v-icon",[t._v("mdi-send")])],1)],1)],1)],1)],1)],1)},O=[],j={name:"home",components:{},data:function(){return{lobby:{socketId:null,name:null,content:""},avatarClass:{size:32,tile:!1,width:null},isShowInputName:!0,isSendWait:!1,waitTime:5e3,lobbyValid:!1,contentRules:[function(t){return!!t||"不可為空"},function(t){return t&&t.length<=100||"超過100個字"}]}},computed:{getLobby:function(){return this.$store.getters["lobby/getData"]},getName:function(){return this.$store.getters["socket/getName"]},getContent:function(){return this.$store.getters["lobby/getContent"]},getSocket:function(){return this.$store.getters["socket/getData"]}},mounted:function(){var t=this;this.getName&&(this.lobby.name=this.getName),this.getContent&&(this.lobby.content=this.getContent),this.scrollToBottom(),this.$nextTick((function(){t.$refs.lobbyContentRef.focus()}))},beforeDestroy:function(){this.setContent(this.lobby.content)},methods:{sendMsg:function(t){var e=this;this.lobbyValid&&t&&this.getName&&(this.lobby.socketId=this.getSocket.id,this.lobby.name=this.getName,this.isSendWait=!0,setTimeout((function(){e.isSendWait=!1}),this.waitTime),this.$store.dispatch("lobby/addDataAction",t).then((function(){e.clearLobbyContent()})))},clearLobbyContent:function(){this.lobby.content=""},setContent:function(t){this.$store.commit("lobby/setContent",t)},scrollToBottom:function(){var t=document.scrollingElement||document.body;t.scrollTop=t.scrollHeight}}},R=j,L=(n("21bb"),n("62ad")),B=n("a523"),F=n("0fd9"),E=Object(r["a"])(R,T,O,!1,null,null,null),q=E.exports;u()(E,{VAvatar:m["a"],VBtn:h["a"],VCard:v["a"],VCol:L["a"],VContainer:B["a"],VForm:w["a"],VIcon:y["a"],VRow:F["a"],VTextField:$["a"]});var z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[n("h1",[t._v("聊天室")]),n("blockquote",{staticClass:"blockquote"},[t._v(" 配對對象: 正在等待配對的使用者中隨機選取一位 ")]),n("div",[n("v-row",[n("v-col",{attrs:{cols:"12",sm:"5",xs:"12"}},[n("v-btn",{staticClass:"success",attrs:{block:"",loading:t.getIsPairing,disabled:t.getIsPairing||t.getIsPaired},on:{click:function(e){return t.pair()}}},[t.getIsPaired?t._e():n("span",[t._v(" 配對 ")]),t.getIsPaired?n("span",[t._v(" 配對成功 ")]):t._e()])],1),n("v-col",{attrs:{cols:"12",sm:"5",xs:"12"}},[n("v-btn",{staticClass:"warning",attrs:{block:""},on:{click:function(e){return t.unpair()}}},[t._v(" 取消配對 ")])],1),n("v-col",{attrs:{cols:"12",sm:"2",xs:"12"}},[n("v-btn",{staticClass:"error",attrs:{block:""},on:{click:function(e){return t.clearChats()}}},[t._v(" 清空 ")])],1)],1)],1),n("v-card",{staticClass:"chat-box"},t._l(t.getChats,(function(e,o){return n("div",{key:o,staticClass:"d-flex",class:{"justify-end":t.getSocket.id!=e.socketId}},[n("div",{staticClass:"mt-2 ml-2"},[t.getSocket.id!=e.socketId?n("span",[t._v(" "+t._s(e.content)+" ")]):t._e(),n("v-avatar",{class:{indigo:t.getSocket.id==e.socketId,green:t.getSocket.id!=e.socketId,"mr-2":t.getSocket.id!=e.socketId},attrs:{size:32,width:e.isMax?150:null,tile:!!e.isMax},on:{mouseover:function(n){return t.mouseoverAvatar(e)},mouseleave:function(n){return t.mouseleaveAvatar(e)}}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!e.isMax,expression:"!msg.isMax"}],staticClass:"white--text headline"},[t._v(" "+t._s(t.getMiniName(e.name))+" ")]),n("span",{directives:[{name:"show",rawName:"v-show",value:e.isMax,expression:"msg.isMax"}],staticClass:"white--text headline"},[t._v(" "+t._s(e.name)+" ")])]),t.getSocket.id==e.socketId?n("span",[t._v(" "+t._s(e.content)+" ")]):t._e()],1)])})),0),n("v-form",{ref:"chatForm",staticClass:"msg-form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.sendMsg(t.content)}},model:{value:t.chatValid,callback:function(e){t.chatValid=e},expression:"chatValid"}},[n("v-container",[n("v-row",[n("v-col",{attrs:{cols:"12",sm:"10",xs:"12"}},[n("v-text-field",{ref:"chatContentRef",attrs:{counter:100,rules:t.contentRules,label:"輸入訊息...",required:""},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),n("v-col",{attrs:{cols:"12",sm:"2",xs:"12"}},[n("v-tooltip",{attrs:{top:"",disabled:t.getIsPaired},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[n("div",t._g({},o),[n("v-btn",{staticClass:"yellow darken-2",attrs:{type:"submit",block:"",disabled:!t.getIsPaired}},[n("v-icon",[t._v("mdi-send")])],1)],1)]}}])},[n("span",[t._v("請先配對")])])],1)],1)],1)],1)],1)},W=[],H={name:"chat",components:{},data:function(){return{content:"",chatValid:!1,contentRules:[function(t){return!!t||"不可為空"},function(t){return t&&t.length<=100||"超過100個字"}]}},computed:{getSocket:function(){return this.$store.getters["socket/getData"]},getName:function(){return this.$store.getters["socket/getName"]},getContent:function(){return this.$store.getters["socket/getContent"]},getIsPaired:function(){return this.$store.getters["socket/getIsPaired"]},getIsPairing:function(){return this.$store.getters["socket/getIsPairing"]},getChats:function(){return this.$store.getters["socket/getChats"]}},mounted:function(){var t=this;this.getContent&&(this.chat.content=this.getContent),this.$nextTick((function(){t.$refs.chatContentRef.focus()}))},beforeDestroy:function(){this.setContent(this.chat.content)},methods:{pair:function(){if(!this.getIsPaired&&!this.getIsPairing){this.setIsPairing(!0);try{this.getSocket.emit("pair")}catch(t){this.setIsPairing(!1)}}},unpair:function(){try{this.getSocket.emit("unpair")}catch(t){}},sendMsg:function(t){if(this.chatValid&&this.getName&&t&&this.getIsPaired&&!this.getIsPairing){var e={socketId:this.getSocket.id,name:this.getName,content:this.content};try{this.getSocket.emit("chat",e),this.clearChatContent()}catch(n){}}},setIsPaired:function(t){this.$store.commit("socket/setIsPaired",t)},setIsPairing:function(t){this.$store.commit("socket/setIsPairing",t)},clearChats:function(){confirm("確定清空嗎")&&this.$store.commit("socket/setChats",[])},setContent:function(t){this.$store.commit("socket/setContent",t)},clearChatContent:function(){this.content=""},mouseoverAvatar:function(t){this.$set(t,"isMax",!0)},mouseleaveAvatar:function(t){this.$set(t,"isMax",!1)},getMiniName:function(t){return t.substring(0,1)}}},J=H,G=(n("9c66"),n("3a2f")),K=Object(r["a"])(J,z,W,!1,null,null,null),U=K.exports;u()(K,{VAvatar:m["a"],VBtn:h["a"],VCard:v["a"],VCol:L["a"],VContainer:B["a"],VForm:w["a"],VIcon:y["a"],VRow:F["a"],VTextField:$["a"],VTooltip:G["a"]}),o["a"].use(M["a"]);var X=[{path:"/",name:"home",component:q},{path:"/chat",name:"chat",component:U},{path:"*",name:"page-not-found",redirect:{name:"home"}}],Q=new M["a"]({mode:"history",base:"/",routes:X}),Y=Q,Z=n("2f62"),tt=(n("7db0"),n("d81d"),n("a9e3"),n("d3b7"),n("159b"),n("59ca"));n("e71f"),n("ea7b");var et={apiKey:"AIzaSyCV30y8HwGxLfSuLbuMsbXIsxTSCfkhITw",authDomain:"chat-room-f6e56.firebaseapp.com",databaseURL:"https://chat-room-f6e56.firebaseio.com",projectId:"chat-room-f6e56",storageBucket:"chat-room-f6e56.appspot.com",messagingSenderId:"973255375090",appId:"1:973255375090:web:ae6824fb413d0bf69bf86b"};tt.initializeApp(et);var nt=tt.firestore(),ot={namespaced:!0,state:{collection:"lobby",data:null,content:""},getters:{getData:function(t){return t.data},getDataById:function(t){return function(e){var n=t.data||[];return n.find((function(t){return t.id==e}))}},getContent:function(t){return t.content}},mutations:{setData:function(t,e){t.data=e},setContent:function(t,e){t.content=e}},actions:{setWatchDataAction:function(t,e){var n=t.state,o=t.commit;nt.collection(n.collection).orderBy("id").onSnapshot((function(t){var e=t.docs.map((function(t){return t.data()}));o("setData",e)}))},getDataAction:function(t,e){var n=t.state,o=t.commit;return new Promise((function(t,e){nt.collection(n.collection).orderBy("id").get().then((function(e){var n=e.docs.map((function(t){return t.data()}));o("setData",n),t(n)})).catch((function(t){e(t)}))}))},addDataAction:function(t,e){var n=t.state,o=(t.commit,t.dispatch,e);return new Promise((function(t,e){nt.collection(n.collection).orderBy("id","desc").limit(1).get().then((function(e){e.forEach((function(e){o.id=Number(e.data().id)+1,o.created=new Date(Date.now()),nt.collection(n.collection).add(o).then((function(){t(o)}))}))})).catch((function(t){e(t.message)}))}))},removeDataAction:function(t,e){var n=t.state,o=(t.commit,t.dispatch),i=e;return new Promise((function(t,e){nt.collection(n.collection).where("id","==",i.id).get().then((function(e){e.forEach((function(e){e.ref.delete().then((function(){o("getDataAction"),t(i)}))}))})).catch((function(t){e(t.message)}))}))},updateDataAction:function(t,e){var n=t.state,o=(t.commit,t.dispatch),i=e;return new Promise((function(t,e){nt.collection(n.collection).where("id","==",i.id).get().then((function(e){e.forEach((function(e){e.data();e.ref.update(i).then((function(){o("getDataAction"),t(i)}))}))})).catch((function(t){e(t)}))}))}}},it=n("8055"),at=n.n(it),st={namespaced:!0,state:{data:null,name:"",content:"",isPaired:!1,isPairing:!1,chats:[]},getters:{getData:function(t){return t.data},getName:function(t){return t.name},getContent:function(t){return t.content},getChat:function(t){return t.chat},getIsPaired:function(t){return t.isPaired},getIsPairing:function(t){return t.isPairing},getChats:function(t){return t.chats}},mutations:{setData:function(t,e){t.data=e},setName:function(t,e){t.name=e},setContent:function(t,e){t.content=e},setChat:function(t,e){t.chat=e},setIsPaired:function(t,e){t.isPaired=e},setIsPairing:function(t,e){t.isPairing=e},setChats:function(t,e){t.chats=e},pushChats:function(t,e){t.chats.push(e)}},actions:{setDataAction:function(t,e){t.state;var n=t.commit,o=e;return new Promise((function(t,e){n("setData",o),t(o)}))}}};o["a"].use(Z["a"]);var ct=new Z["a"].Store({state:{},mutations:{},actions:{},modules:{lobby:ot,socket:st}}),rt=n("f309");o["a"].use(rt["a"]);var lt=new rt["a"]({});o["a"].config.productionTip=!1;var ut=at()();new o["a"]({router:Y,store:ct,vuetify:lt,beforeCreate:function(){var t=this;this.$store.dispatch("lobby/getDataAction").then((function(t){})),this.$store.dispatch("lobby/setWatchDataAction"),ut.on("connect",(function(){t.$store.dispatch("socket/setDataAction",ut).then((function(e){setTimeout((function(){t.scrollToBottom()}),1e3)}))}))},methods:{scrollToBottom:function(){var t=document.scrollingElement||document.body;t.scrollTop=t.scrollHeight}},render:function(t){return t(N)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";var o=n("7694"),i=n.n(o);i.a},7694:function(t,e,n){},"9c66":function(t,e,n){"use strict";var o=n("4931"),i=n.n(o);i.a},d63f:function(t,e,n){}});
//# sourceMappingURL=app.cca98dde.js.map